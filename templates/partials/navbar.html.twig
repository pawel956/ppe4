<nav class="navbar navbar-expand-lg navbar-dark bg-dark navbar-fixed-top">

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#menu">
        <span class="navbar-toggler-icon"></span>
    </button>

    <button class="navbar-toggler" data-toggle="collapse" data-target="#search">
        <span class="fas fa-search"></span>
    </button>

    <i class="navbar" data-toggle="collapse" data-target="#logo">
        <a class="logo" href="{{ path('index') }}"></a>
    </i>

    <button class="navbar-toggler" type="button">
        <div class="dropdown dropleft">
            <i class="hypertext fas fa-user" data-toggle="dropdown"></i>
            <div class="dropdown-menu">
                {% if not is_granted('ROLE_USER') %}
                    <a class="dropdown-item" href="{{ path('app_register') }}">Inscription</a>
                    <a class="dropdown-item" href="{{ path('app_login') }}">Connexion</a>
                {% else %}
                    <a class="dropdown-item"
                       href="/PPE_Projet/compte/profil.php"><b>{{ app.user.nom ~ ' ' ~ app.user.prenom }}</b></a>
                    <hr>
                    <a class="dropdown-item" href="/PPE_Projet/compte/mes_commandes.php">Mes commandes</a>
                    <hr>
                    <a class="dropdown-item" data-toggle="modal" data-target="#logoutModal" href="#">Déconnexion</a>
                {% endif %}
            </div>
        </div>
    </button>

    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#shop">
        <a href="/PPE_Projet/compte/panier.php">
            <span class="fas fa-shopping-cart"></span>
        </a>
        {% if is_granted('ROLE_USER') %}
            <div class="contenu_panier_mobile">
                {#            <?php#}
                {#                $req = "SELECT SUM(qte) FROM panier WHERE identifiant='$identifiant'";#}
                {#                $res = $pdo->query($req);#}
                {#            $row = $res->fetchAll();#}
                {#            if (($row[0][0]) == 0) {#}
                {#            echo "0";#}
                {#            } else {#}
                {#            echo $row[0][0];#}
                {#            }#}
                {#            }#}
                {#            ?>#}
            </div>
        {% endif %}
    </button>

    <div class="collapse navbar-collapse" id="menu">
        <ul class="navbar-nav">
            {% for marque in partials.marques %}
                <li class="nav-item dropdown">
                    <div class="nav2">
                        <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                            {{ marque.libelle|upper }}
                        </a>
                        <div class="dropdown-menu">
                            {% for typeProduit in partials.typeProduits %}
                                {% if marque.libelle != 'Steam' or typeProduit.libelle != 'Consoles' %}
                                    <a class="dropdown-item"
                                       href="/PPE_Projet/produits.php?plateforme=ps4&categorie=jeux">{{ typeProduit.libelle }}</a>
                                {% endif %}
                            {% endfor %}
                        </div>
                    </div>
                </li>
            {% endfor %}
        </ul>
    </div>


    <div class="collapse navbar-collapse centrage" id="search">
        <div class="resultat">
            <input class="form-control-search mr-sm-3 text" name="recherche" id="recherche" type="text"
                   placeholder="Recherche ...">
            <button class="btn btn-dark" type="submit"><i class="fas fa-search"></i></button>
            <div class="resultat-result" id="resultat"></div>
        </div>
    </div>


    <div class="collapse navbar-collapse rightnav" id="user">
        <div class="dropdown dropleft">
            <i class=" nav-link hypertext fas fa-user" data-toggle="dropdown"></i>
            <div class="dropdown-menu">
                {% if not is_granted('ROLE_USER') %}
                    <a class="dropdown-item" href="{{ path('app_register') }}">Inscription</a>
                    <a class="dropdown-item" href="{{ path('app_login') }}">Connexion</a>
                {% else %}
                    <a class="dropdown-item"
                       href="/PPE_Projet/compte/profil.php"><b>{{ app.user.nom ~ ' ' ~ app.user.prenom }}</b></a>
                    <hr>
                    <a class="dropdown-item" href="/PPE_Projet/compte/mes_commandes.php">Mes commandes</a>
                    <hr>
                    <a class="dropdown-item" data-toggle="modal" data-target="#logoutModal" href="#">Déconnexion</a>
                {% endif %}
            </div>
        </div>

        {% if not is_granted('ROLE_USER') %}
            <div class="collapse navbar-collapse" id="shop">
                <a class="nav-link hypertext" href="{{ path('app_login') }}">
                    <i class="fas fa-shopping-cart"></i>
                </a>
            </div>
        {% endif %}
        {#        <?php#}
        {#        if (isset($_SESSION['identifiant'])) { // Si on ne détecte pas de session alors on verra les liens ci-dessous#}
        {#            $identifiant = $_SESSION['identifiant'];#}
        {#            $req = "SELECT * FROM panier, utilisateurs, produits WHERE panier.identifiant=utilisateurs.identifiant AND panier.reference=produits.identifiant AND panier.identifiant='$identifiant'";#}
        {#            $res = $pdo->query($req);#}
        {#        ?>#}
        {#        <div class="collapse navbar-collapse" id="shop">#}
        {#            <div class="dropdown dropleft">#}
        {#                <a class="nav-link hypertext" href="/PPE_Projet/compte/panier.php" class="dropdown-toggle" data-toggle="dropdown"><i class="fas fa-shopping-cart" ></i></a>#}
        {#                <?php#}
        {#                    $compteur = $res->fetchAll();#}
        {#                if (count($compteur) > 0) {#}
        {#                ?>#}
        {#                <ul class="dropdown-menu dropdown-cart" role="menu">#}
        {#                    <?php#}
        {#                            $req = "SELECT * FROM panier, utilisateurs, produits WHERE panier.identifiant=utilisateurs.identifiant AND panier.reference=produits.identifiant AND panier.identifiant='$identifiant'";#}
        {#                            $res = $pdo->query($req);#}
        {#                    while ($row = $res->fetch()) {#}
        {#                    ?>#}
        {#                    <li>#}
        {#                                    <span class="item">#}
        {#                                        <span class="item-left padding_recap">#}
        {#                                            <img class="resize_navbar" src="<?php echo $row['image']; ?>" alt="" />#}
        {#                                            <span class="item-info">#}
        {#                                                <span class="uppercase"><?php echo $row['plateforme']; ?> x <?php echo $row['qte']; ?> </span>#}
        {#                                                <span><?php echo $row['prix']; ?> &euro; / unité </span>#}
        {#                                            </span>#}
        {#                                        </span>#}
        {#                                        <span class="item-right">#}
        {#                                            <a href="/PPE_Projet/scripts/traitement_supprimer_produit?identifiant_produit=<?php echo $row['identifiant']; ?>" class="btn btn-xs btn-danger pull-right">x</a>#}
        {#                                        </span>#}
        {#                                    </span>#}
        {#                    </li>#}
        {#                    <?php#}
        {#                            }#}
        {#                            ?>#}
        {#                    <br />#}
        {#                    <center><a class="btn btn-primary" href="/PPE_Projet/compte/panier.php">Afficher le panier</a></li></center>#}
        {#                </ul>#}
        {#                <?php#}
        {#                    }#}
        {#                    ?>#}
        {#            </div>#}
        {#            <?php#}
        {#            } else {#}
        {#                ?>#}
        {#            <div class="collapse navbar-collapse" id="shop">#}
        {#                <a class="nav-link hypertext" href="/PPE_Projet/compte/connexion.php"><i class="fas fa-shopping-cart"></i></a>#}
        {#                <?php#}
        {#                }#}
        {#                ?>#}
        {#                <?php#}
        {#                if (isset($_SESSION['identifiant'])) {#}
        {#                    ?>#}
        {#                <div class = "contenu_panier">#}
        {#                    <?php#}
        {#                        $req = "SELECT SUM(qte) FROM panier WHERE identifiant='$identifiant'";#}
        {#                        $res = $pdo->query($req);#}
        {#                    $row = $res->fetchAll();#}
        {#                    if (($row[0][0]) == 0) {#}
        {#                    echo "0";#}
        {#                    } else {#}
        {#                    echo $row[0][0];#}
        {#                    }#}
        {#                    }#}
        {#                    ?>#}
        {#                </div>#}
        {#            </div>#}
        {#        </div>#}
    </div>
</nav>

<div class="modal fade" id="logoutModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Vous nous quittez ?</h5>
                <button class="close" type="button" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">Sélectionnez "Se déconnecter" si vous êtes prêt à mettre fin à votre session en
                cours.
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-dismiss="modal">Annuler</button>
                <a class="btn btn-primary" href="{{ path('app_logout') }}">Se déconnecter</a>
            </div>
        </div>
    </div>
</div>


{#<script>#}
{#    $(document).ready(function () {#}
{#        $("#recherche").keyup(function () {#}
{#            var recherche = $(this).val();#}
{#            var data = 'motclef=' + recherche;#}
{#            if (recherche.length > 0) {#}

{#                $.ajax({#}
{#                    type: "GET",#}
{#                    url: "/PPE_Projet/scripts/traitement_resultats.php",#}
{#                    data: data,#}
{#                    success: function (server_response) {#}

{#                        $("#resultat").html(server_response).show();#}
{#                    }#}
{#                });#}
{#            } else {#}
{#                $("#resultat").html("").show();#}
{#            }#}

{#        });#}
{#    });#}
{#</script>#}